/* eslint-disable no-debugger */
/* eslint-disable no-case-declarations */
/* eslint-disable no-undef */
// @ts-nocheck

(function(){
	const vscode = acquireVsCodeApi();

	document.getElementById('query').addEventListener('keydown', function(event) {
		if (event.key === 'Enter') {
			event.preventDefault();
			const content = event.target.value;
			if (content.trim()) {
				vscode.postMessage({
					command: 'addMessage',
					message: {
						role: 'dreamscript',
						content: content.trim()
					}
				});
				event.target.value = '';
			}
			return false;
		}
	});
	document.addEventListener('DOMContentLoaded', (event) => {
		const loadingAnimation = document.getElementsByClassName("loadingAnimation");
        window.addEventListener('message', event => {
            const message = event.data;
            switch (message.command) {
                case 'loadMetadata':
					const messages = document.getElementsByClassName("message");
					messages[messages.length - 1].scrollIntoView();
                    break;
				////
				case 'startLLMResponseChunk':
					loadingAnimation[0].classList.add("in");
					break;
				case 'endLLMResponseChunk':
					loadingAnimation[0].classList.remove("in");
					break;
                case 'addLLMResponseChunk':
					// Optimize selection
					const streamedRaw = document.getElementsByClassName("streamedRaw");
					const streamed = document.getElementsByClassName("streamed");
					const streamedRole = document.getElementsByClassName("streamedRole");
					loadingAnimation[0].classList.add("in");
					const content = event.data.data.response;
					const model = event.data.data.model;
					streamedRole[0].innerHTML = "˜”*°•.˜”*°• " + model + " •°*”˜.•°*”˜";
					streamedRaw[0].innerHTML = streamedRaw[0].innerHTML + content;
					streamed[0].innerHTML = marked.parse(streamedRaw[0].innerHTML);
					// streamed[0].querySelectorAll('*').forEach(element => {
					// 	element.classList.add('fadeable');
					// 	setTimeout(() => {
					// 		element.classList.add('in');
					// 	}, 100);
					// });
					loadingAnimation[0].scrollIntoView();
					// streamed[0].innerHTML += content;
					
                    break;
            }
        });
	});
}());
